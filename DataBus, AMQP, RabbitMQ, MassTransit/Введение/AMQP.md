## Что такое AMQP
В один прекрасный день, собрались инженеры с духом, и разработали AMQP — Advanced Message Queuing Protocol. Этот протокол позволяет не задумываться над тем, где находятся получатели сообщения, сколько их, от кого надо ждать сообщение, когда оно будет доставлено получателю. Кроме этого, AMQP снимает с разработчика ещё многие рутинные задачи и позволяет заниматься непосредственной проблемой, а не обслуживанием процесса разработки.
AMQP имеет три базовых понятия:
- Обменник (exchange) - в нее отправляются сообщения. Точка обмена распределяет сообщения в одну или несколько очередей. При этом в точке обмена сообщения не хранятся. Точки обмена бывают трех типов: fanout — сообщение передается во все прицепленные к ней очереди; direct — сообщение передается в очередь с именем, совпадающим с ключом маршрутизации (routing key) (ключ маршрутизации указывается при отправке сообщения); topic — нечто среднее между fanout и exchange, сообщение передается в очереди, для которых совпадает маска на ключ маршрутизации - например, `app.notification.sms.*` — в очередь будут доставлены все сообщения, отправленные с ключами, начинающимися на `app.notification.sms`
- Очередь (queue) - Здесь хранятся сообщения до тех пор, пока не будет забраны клиентом. Клиент всегда забирает сообщения из одной или нескольких очередей.
- Сообщение (message) - единица передаваемых данных, основная его часть (содержание) никак не интерпретируется сервером, к сообщению могут быть прицеплены структурированные заголовки.
Обмен сообщениями осуществляется в пределах одного обменника, в котором определены связи, являющиеся своеобразными маршрутами, по которым идут сообщения, попавшие в этот обменник. Каждый маршрут связывает обменник с одной или несколькими очередями. Программное обеспечение, реализующее описанные действия, называют AMQP-сервером. Узлы, помещающие сообщения в обменники и получающие их из очередей, называются AMQP-клиентами. Другими словами, AMQP-сервер предоставляет шину обмена данными, а AMQP-клиенты используют эту шину для обмена сообщениями между собой.
## Техническая часть протокола
Технически протокол AMQP устроен достаточно интересно: на самом нижнем уровне определяется формат кодирования данных в бинарный вид для передачи по TCP-соединению, выше лежит формат передачи RPC-запросов между сервером и клиентом. Сама семантика работы с сообщениями, создания очередей и т.п. описывается в XML-спецификации, которая по сути задает RPC-интерфейс сервера и клиента (примеры таких XML-файлов для версий [0-8](http://jira.amqp.org/confluence/download/attachments/720900/amqp0-8.xml?version=1) и [0-10](http://jira.amqp.org/confluence/download/attachments/720900/amqp.0-10.xml?version=1)). Этот XML является последней и конечной спецификацией протокола. Более того, версии протокола 0-8 и 0-10 отличаются настолько сильно, что поддерживать их одновременно вряд ли возможно в одной программе. Что еще более интересно, иногда такие spec-файлы для разных брокеров AMQP, формально поддерживающих одну и ту же версию протокола, отличаются настолько, что не являются взаимозаменяемыми. Но это скорее небольшие технические проблемы.
## Что дальше?
Существует несколько реализаций брокеров сообщений, которые используют протокол AMQP.
В рамках этой базы знаний будет рассмотрен такой брокер сообщений как RabbitMQ [[RabbitMQ. Введение|(Тык)]].
## Полезные ссылки
[Messaging in general and AMQP design](http://www.zeromq.org/whitepapers:amqp-analysis)
[Сравнение различных реализаций брокеров использующих AMQP](https://wiki.secondlife.com/wiki/Message_Queue_Evaluation_Notes)
